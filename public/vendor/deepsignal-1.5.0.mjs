import"@preact/signals";import{useMemo as e}from"preact/hooks";import{Signal as t,signal as r,computed as s}from"@preact/signals-core";const n=new WeakMap,a=new WeakMap,o=new WeakMap,l=new WeakSet,c=new WeakMap,f=/^\$/,g=Object.getOwnPropertyDescriptor;let i=!1;const p=e=>{if(!k(e))throw new Error("This object can't be observed.");return a.has(e)||a.set(e,y(e,d)),a.get(e)},u=(e,t)=>{i=!0;const r=e[t];try{i=!1}catch(e){}return r};function h(e){return l.add(e),e}const y=(e,t)=>{const r=new Proxy(e,t);return l.add(r),r},w=()=>{throw new Error("Don't mutate the signals directly.")},v=e=>(t,l,c)=>{var p;if(i)return Reflect.get(t,l,c);let u=e||"$"===l[0];if(!e&&u&&Array.isArray(t)){if("$"===l)return o.has(t)||o.set(t,y(t,m)),o.get(t);u="$length"===l}n.has(c)||n.set(c,new Map);const h=n.get(c),w=u?l.replace(f,""):l;if(h.has(w)||"function"!=typeof(null==(p=g(t,w))?void 0:p.get)){let e=Reflect.get(t,w,c);if(u&&"function"==typeof e)return;if("symbol"==typeof w&&b.has(w))return e;h.has(w)||(k(e)&&(a.has(e)||a.set(e,y(e,d)),e=a.get(e)),h.set(w,r(e)))}else h.set(w,s(()=>Reflect.get(t,w,c)));return u?h.get(w):h.get(w).value},d={get:v(!1),set(e,s,o,l){var i;if("function"==typeof(null==(i=g(e,s))?void 0:i.set))return Reflect.set(e,s,o,l);n.has(l)||n.set(l,new Map);const p=n.get(l);if("$"===s[0]){o instanceof t||w();const r=s.replace(f,"");return p.set(r,o),Reflect.set(e,r,o.peek(),l)}{let t=o;k(o)&&(a.has(o)||a.set(o,y(o,d)),t=a.get(o));const n=!(s in e),f=Reflect.set(e,s,o,l);return p.has(s)?p.get(s).value=t:p.set(s,r(t)),n&&c.has(e)&&c.get(e).value++,Array.isArray(e)&&p.has("length")&&(p.get("length").value=e.length),f}},deleteProperty(e,t){"$"===t[0]&&w();const r=n.get(a.get(e)),s=Reflect.deleteProperty(e,t);return r&&r.has(t)&&(r.get(t).value=void 0),c.has(e)&&c.get(e).value++,s},ownKeys:e=>(c.has(e)||c.set(e,r(0)),c._=c.get(e).value,Reflect.ownKeys(e))},m={get:v(!0),set:w,deleteProperty:w},b=new Set(Object.getOwnPropertyNames(Symbol).map(e=>Symbol[e]).filter(e=>"symbol"==typeof e)),R=new Set([Object,Array]),k=e=>"object"==typeof e&&null!==e&&R.has(e.constructor)&&!l.has(e),M=t=>e(()=>p(t),[]);export{p as deepSignal,u as peek,h as shallow,M as useDeepSignal};//# sourceMappingURL=deepsignal-1.5.0.mjs.map
